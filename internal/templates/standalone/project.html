<html>
    –ü—Ä–æ—Ñ–∏–ª—å: {{user_id}} {{user_name}} {{user_surname}}
    <br>
    –ü—Ä–æ–µ–∫—Ç —Ç–∏–ø–∞ <input id="type" value="{{project_type}}" type="text"> &quot;<input id="name" value="{{project_name}}" type="text">&quot; ({{project_id}}), —Å–æ–∑–¥–∞–Ω <span id="crtime"></span>
    <br>
    –°–æ–∑–¥–∞—Ç–µ–ª—å: {{project_user_id}} {{project_user_name}} {{project_user_surname}}
    <br>
    –û–ø–∏—Å–∞–Ω–∏–µ: <input id="desc" value="{{project_description}}" type="text">
    <br>
    –û–±–ª–æ–∂–∫–∞: 
    <img src="/project/{{project_id}}/thumbnail">
    <form id="thumbnail_form" enctype="multipart/form-data">
    <input name="thumbnail" type="file" onchange="thumbnail_updated(this)">
    </form>
    <button id="thumbnail_submit" hidden onclick="update_thumbnail('#thumbnail_form')">–í—ã–≥—Ä—É–∑–∏—Ç—å</button>
    <br>
    –§–∞–π–ª:
    <a href="/project/{{project_id}}/content">pdf</a>
    <form id="content_form" enctype="multipart/form-data">
    <input name="content" type="file" onchange="content_updated(this)">
    </form>
    <button id="content_submit" hidden onclick="update_content('#content_form')">–í—ã–≥—Ä—É–∑–∏—Ç—å</button>
    <br>
    <button onclick="update_fields($('#name').val(), $('#type').val(), $('#orig').val(), $('#tran').val(), $('#desc').val())">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë</button>
    –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä: 
    <table>
        <tr>
            <th>
                –û—Ä–∏–≥–∏–Ω–∞–ª <input id="orig" value="{{project_original}}" type="text">
            </th>
            <th>
                –ü–µ—Ä–µ–≤–æ–¥ <input id="tran" value="{{project_translation}}" type="text">
            </th>
        </tr>
        {% for preview in project_previews %}
        <tr id="preview_{{loop.index - 1}}"> <!--loop.index - –∏–Ω–¥–µ–∫—Å –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ü–∏–∫–ª–∞ (–Ω–µ —Å –Ω—É–ª—è, –∞ —Å –µ–¥–∏–Ω–∏—Ü—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ –±–ª—è—Ç—å –ø–æ—Ç–æ–º—É —á—Ç–æ)-->
            <td><input type="text" value="{{preview[0]}}"></td>
            <td><input type="text" value="{{preview[1]}}"></td>
            <td><button onclick="update_preview(this.parentElement.parentElement.id)">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button onclick="remove_preview(this.parentElement.parentElement.id)">–£–¥–∞–ª–∏—Ç—å</button></td>
        </tr>
        {% endfor %}
        <tr>
            <td><input id="neworig" type="text"></td>
            <td><input id="newtran" type="text"></td>
            <td><button onclick="add_preview($('#neworig').val(), $('#newtran').val())">–î–æ–±–∞–≤–∏—Ç—å</button></td>
        </tr>
    </table>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>













    <script>
    // –ü–µ—Ä–µ–≤–æ–¥ –∏–∑ epoch time –≤ Date –∏ –≤ —Å—Ç—Ä–æ–∫—É (jinja –Ω–µ –º–æ–∂–µ—Ç —Å–∞–º –ø–µ—Ä–µ–≤–µ—Å—Ç–∏)
    date = new Date(0);
    date.setUTCSeconds({{project_date}});
    $('#crtime').text( date.toString() ); // –º–æ–∂–µ—à—å —Å–∞–º —Å–∫–ª–µ–∏—Ç—å –∏–∑ .getMonth(), .getDate() –∏ —Ç –¥

    function update_fields(name, type, original, translation, description)
    {
        $.post('/project/{{project_id}}/update',
        {
            'name': name,
            'type': type,
            'original': original,
            'translation': translation,
            'description': description,
        },
        function(response)
        {
        }, 'json');    
    }





    // —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–∞—Å—Å–∏–≤–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (add_html, remove_html –∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É —Å–∞–º –¥–æ–±–∞–≤–∏—à—å)
    function add_preview(original, translation)
    {
        $.post('/project/{{project_id}}/addpreview',
        {
            'original': original,
            'translation': translation
        },
        function(response)
        {
        }, 'json');
    }
    function update_preview(id)
    {
        let splitstr = id.split('_');
        let index = parseInt(splitstr[splitstr.length - 1]);

        let original = $(`#${id}`).children('td') // children() –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º, –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–µ–≥ –Ω—É–∂–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                                                 .eq(0) // eq() —ç—Ç–æ –∏–Ω–¥–µ–∫—Å–∞—Ç–æ—Ä ( [] –±–µ—Ä—ë—Ç –Ω–µ —ç–ª–µ–º–µ–Ω—Ç, –∞ —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∫ html —Ç–µ–∫—Å—Ç ü§∑‚Äç‚ôÇÔ∏è)
                                                       .children('input').eq(0).val(); // –¥–∞–ª—å—à–µ –ø–æ-–∞–Ω–∞–ª–æ–≥–∏–∏
        let translation = $(`#${id}`).children('td').eq(1).children('input').eq(0).val();
        // —è –Ω–µ–Ω–∞–≤–∏–∂—É jquery –∏ js, —Å–∞–º—ã–π —É–µ–±–∞–Ω—Å–∫–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏
        
        $.post('/project/{{project_id}}/updatepreview',
        {
            'index': index,
            'original': original,
            'translation': translation
        },
        function(response)
        {
        }, 'json');
    }
    function remove_preview(id)
    {
        let splitstr = id.split('_');
        let index = parseInt(splitstr[splitstr.length - 1]);
        $.post('/project/{{project_id}}/removepreview',
        {
            'index': index,
        },
        function(response)
        {
        }, 'json');
    }






    // —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±–ª–æ–∂–∫–∏
    let thumbnail_valid = false;
    function update_thumbnail(form_id)
    {
        if(!thumbnail_valid)
            return;
        $.ajax(
        {
            url: '/project/{{project_id}}/newthumbnail',
            type: 'POST',
            data: new FormData($(form_id)[0]),
            cache: false,
            processData: false,  
            contentType: false,
            success: function(response)
            {
                $('#thumbnail_submit').attr('hidden', true);
            }
        });
    }
    function thumbnail_updated(input)
    {
        let file = input.files[0];
        thumbnail_valid = false;
        $('#thumbnail_submit').attr('hidden', true);
        if(file.type != 'image/jpeg')
        {
            alert('–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º JPEG.');
            return;
        }
        if(file.size > 1024*1024*2)
        {
            alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 2 –ú–ë.');
            return;
        }
        thumbnail_valid = true;
        $('#thumbnail_submit').attr('hidden', false);
    }






    // —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞
    let content_valid = false;
    function update_content(form_id)
    {
        if(!content_valid)
            return;
        $.ajax(
        {
            url: '/project/{{project_id}}/newcontent',
            type: 'POST',
            data: new FormData($(form_id)[0]),
            cache: false,
            processData: false,  
            contentType: false,
            success: function(response)
            {
                $('#content_submit').attr('hidden', true);
            }
        });
    }
    function content_updated(input)
    {
        let file = input.files[0];
        content_valid = false;
        $('#content_submit').attr('hidden', true);
        if(file.type != 'application/pdf')
        {
            alert('–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º PDF.');
            return;
        }
        if(file.size > 1024*1024*20)
        {
            alert('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 20 –ú–ë.');
            return;
        }
        content_valid = true;
        $('#content_submit').attr('hidden', false);
    }

    </script>
</html>